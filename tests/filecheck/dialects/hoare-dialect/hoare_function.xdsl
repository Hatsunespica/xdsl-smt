// RUN: xdsl-smt.py %s | xdsl-smt.py | filecheck %s

builtin.module() {
  func.func() ["sym_name" = "test", "function_type" = !fun<[!i32, !i32], [!i32]>, "sym_visibility" = "private"] {
  ^0(%x: !i32, %y: !i32):
    hoare.requires() {
      ^1(%x2: !smt.bv.bv<32>, %y2: !smt.bv.bv<32>):
        %x2neg: !smt.bv.bv<32> = smt.bv.neg %x2
        %eq : !smt.bool = smt.eq %x2neg, %y2
        hoare.yield(%eq: !smt.bool)
    }
    hoare.ensures() {
      ^2(%x3: !smt.bv.bv<32>, %y3: !smt.bv.bv<32>, %r3: !smt.bv.bv<32>):
        %zero : !smt.bv.bv<32> = smt.bv.constant !smt.bv.bv_val<0: 32>
        %eq : !smt.bool = smt.eq %r3, %zero
        hoare.yield(%eq: !smt.bool)    
    }
    %r : !i32 = arith.addi(%x: !i32, %y: !i32)
    func.return(%r: !i32)
  }
}


// CHECK:      builtin.module() {
// CHECK-NEXT:   func.func() ["sym_name" = "test", "function_type" = !fun<[!i32, !i32], [!i32]>, "sym_visibility" = "private"] {
// CHECK-NEXT:   ^0(%x : !i32, %y : !i32):
// CHECK-NEXT:     hoare.requires() {
// CHECK-NEXT:     ^1(%x2 : !smt.bv.bv<32>, %y2 : !smt.bv.bv<32>):
// CHECK-NEXT:       %x2neg : !smt.bv.bv<32> = smt.bv.neg %x2
// CHECK-NEXT:       %eq : !smt.bool = smt.eq %x2neg, %y2
// CHECK-NEXT:       hoare.yield(%eq : !smt.bool)
// CHECK-NEXT:     }
// CHECK-NEXT:     hoare.ensures() {
// CHECK-NEXT:     ^2(%x3 : !smt.bv.bv<32>, %y3 : !smt.bv.bv<32>, %r3 : !smt.bv.bv<32>):
// CHECK-NEXT:       %zero : !smt.bv.bv<32> = smt.bv.constant !smt.bv.bv_val<0: 32>
// CHECK-NEXT:       %eq_1 : !smt.bool = smt.eq %r3, %zero
// CHECK-NEXT:       hoare.yield(%eq_1 : !smt.bool)
// CHECK-NEXT:     }
// CHECK-NEXT:     %r : !i32 = arith.addi(%x : !i32, %y : !i32)
// CHECK-NEXT:     func.return(%r : !i32)
// CHECK-NEXT:   }
// CHECK-NEXT: }
